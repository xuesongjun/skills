---
name: save-progress
description: |
  存盘 - 将当前开发进度保存到 CLAUDE.md
---

# 存盘 / 结束今天任务

当用户说出以下关键词时自动触发此技能：
- "存盘"
- "结束今天任务"
- "保存进度"
- "收工"

## 执行步骤（必须严格按顺序执行）

### 第一步：回顾本次会话

梳理本次对话中完成的所有工作，包括：
- 修复了哪些 Bug（具体函数名、文件名、错误信息）
- 新增了哪些功能或核心逻辑
- 修改了哪些配置

### 第二步：读取 CLAUDE.md

读取项目根目录的 `CLAUDE.md`，了解当前已记录的进度状态。

### 第三步：更新当前进度

在 `CLAUDE.md` 的 `### 已完成功能` 列表中：
- 将本次会话中完成的功能标记为 `- [x]`（如果之前未记录则新增一行）
- 将本次会话中发现但未完成的任务移到 `### 已知问题` 或新增到待办区域
- 已经修复的已知问题从列表中删除或标记为已解决

### 第四步：追加进度记录

在 `## 开发进度` 章节的 `### 已知问题` 之前，追加如下格式的内容：

```markdown
### YYYY-MM-DD 进度记录

#### 本次完成
- 具体完成的功能或修复，附带文件和函数名
  - 例：修复 `sensitivity_scan()` 中 `rssi` 变量未初始化导致的 `referenced before assignment` 错误（`src/logic/ble_per_test.py:591`）

#### 关键变更
| 文件 | 变更类型 | 说明 |
|------|---------|------|
| `path/to/file.py` | Bug 修复 / 新功能 / 重构 | 具体描述 |

#### 断点 / 待续
- 下次回来时应该从哪个具体的函数或文件继续
- 未完成的任务描述（附上下文，让下次读档能立刻理解）
- 如无则写"无"

#### 运行命令 / 备忘
- 如果新增了依赖，记录 `pip install xxx`
- 如果新增了脚本或启动方式，记录命令
- 调试时发现的关键信息（串口命令格式、寄存器地址、特殊配置等）
- 如无变化则写"无新增"
```

### 第五步：检查运行命令

对比本次会话的变更，检查是否需要更新 `CLAUDE.md` 中的 `## 常用命令` 章节：
- 是否新增了 Python 依赖（需更新 requirements.txt 和安装命令）
- 是否新增了脚本文件或启动方式
- 是否修改了端口号或配置路径
- 如有变化则同步更新 `## 常用命令` 章节

### 第六步：写入文件

将更新后的内容写回 `CLAUDE.md`。

## 注意事项

- 日期使用当天实际日期
- "本次完成"只记录本次会话中实际做了的事，不要编造
- "关键变更"用表格形式，明确标注变更类型（Bug 修复 / 新功能 / 重构 / 配置变更）
- "断点 / 待续"要写得足够具体，让下次读档时能立刻定位到代码位置
- 如果同一天已有进度记录，追加到该天记录下方，不要覆盖之前的记录
- 保持 CLAUDE.md 其余内容不变（项目简介、目录结构、技术栈、代码风格等不动）
- 已完成功能列表和已知问题列表需要与本次会话的实际工作保持一致
